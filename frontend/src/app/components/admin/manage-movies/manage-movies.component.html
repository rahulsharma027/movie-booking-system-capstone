<div class="admin-container">
  <div class="page-header">
    <div class="header-content">
      <h1>Manage Movies</h1>
      <p class="subtitle">Add, edit, and manage movie information including posters and trailers</p>
    </div>
    <button class="btn btn-primary" (click)="openAddModal()">
      <span>+</span> Add New Movie
    </button>
  </div>

  <div class="table-container">
    <table class="data-table">
      <thead>
        <tr>
          <th class="th-id">ID</th>
          <th class="th-poster">Poster</th>
          <th class="th-title">Title</th>
          <th class="th-genre">Genre</th>
          <th class="th-duration">Duration</th>
          <th class="th-language">Language</th>
          <th class="th-rating">Rating</th>
          <th class="th-date">Release Date</th>
          <th class="th-actions">Actions</th>
        </tr>
      </thead>
      <tbody>
        @for (movie of movies; track movie.id) {
          <tr class="table-row">
            <td class="td-id">{{ movie.id }}</td>
            <td class="td-poster">
              <img [src]="movie.posterUrl" [alt]="movie.title" class="poster-thumb" />
            </td>
            <td class="td-title">
              <div class="title-cell">
                <strong>{{ movie.title }}</strong>
                @if (movie.trailerUrl) {
                  <span class="badge badge-success">Has Trailer</span>
                }
              </div>
            </td>
            <td class="td-genre">
              <span class="badge badge-genre">{{ movie.genre }}</span>
            </td>
            <td class="td-duration">{{ movie.duration }} min</td>
            <td class="td-language">{{ movie.language }}</td>
            <td class="td-rating">
              <span class="rating-badge">‚≠ê {{ movie.rating }}/10</span>
            </td>
            <td class="td-date">{{ movie.releaseDate | date:'MMM d, y' }}</td>
            <td class="td-actions">
              <div class="action-buttons">
                <button class="btn btn-sm btn-edit" (click)="openEditModal(movie)" title="Edit Movie">
                  <span>‚úèÔ∏è</span> Edit
                </button>
                <button class="btn btn-sm btn-delete" (click)="deleteMovie(movie.id)" title="Delete Movie">
                  <span>üóëÔ∏è</span> Delete
                </button>
              </div>
            </td>
          </tr>
        }
        @empty {
          <tr>
            <td colspan="9" class="empty-state">
              <div class="empty-content">
                <span class="empty-icon">üé¨</span>
                <p>No movies found. Add your first movie to get started!</p>
              </div>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>

  @if (showModal) {
    <div class="modal-overlay" (click)="closeModal()">
      <div class="modal modal-large" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <div class="modal-title-section">
            <h2>{{ editMode ? 'Edit Movie' : 'Add New Movie' }}</h2>
            <p class="modal-subtitle">{{ editMode ? 'Update movie details, poster, and trailer link' : 'Fill in all the details to add a new movie' }}</p>
          </div>
          <button class="close-btn" (click)="closeModal()">√ó</button>
        </div>

        <div class="modal-body">
          <div class="form-section">
            <h3 class="section-heading">Basic Information</h3>
            
            <div class="form-group">
              <label class="form-label">Movie Title <span class="required">*</span></label>
              <input 
                type="text" 
                [(ngModel)]="currentMovie.title" 
                class="form-control" 
                placeholder="Enter movie title"
              />
            </div>

            <div class="form-group">
              <label class="form-label">Description <span class="required">*</span></label>
              <textarea 
                [(ngModel)]="currentMovie.description" 
                class="form-control" 
                rows="4"
                placeholder="Enter movie description or synopsis"
              ></textarea>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Genre <span class="required">*</span></label>
                <input 
                  type="text" 
                  [(ngModel)]="currentMovie.genre" 
                  class="form-control"
                  placeholder="e.g., Action, Drama, Comedy"
                />
              </div>

              <div class="form-group">
                <label class="form-label">Language <span class="required">*</span></label>
                <input 
                  type="text" 
                  [(ngModel)]="currentMovie.language" 
                  class="form-control"
                  placeholder="e.g., English, Hindi, Tamil"
                />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Duration (minutes) <span class="required">*</span></label>
                <input 
                  type="number" 
                  [(ngModel)]="currentMovie.duration" 
                  class="form-control"
                  placeholder="120"
                  min="1"
                />
              </div>

              <div class="form-group">
                <label class="form-label">Rating (0-10) <span class="required">*</span></label>
                <input 
                  type="number" 
                  step="0.1" 
                  [(ngModel)]="currentMovie.rating" 
                  class="form-control"
                  placeholder="8.5"
                  min="0"
                  max="10"
                />
              </div>

              <div class="form-group">
                <label class="form-label">Release Date <span class="required">*</span></label>
                <input 
                  type="date" 
                  [(ngModel)]="currentMovie.releaseDate" 
                  class="form-control"
                />
              </div>
            </div>
          </div>

          <div class="form-section">
            <h3 class="section-heading">Media & Links</h3>
            
            <div class="form-group">
              <label class="form-label">Poster URL <span class="required">*</span></label>
              <input 
                type="url" 
                [(ngModel)]="currentMovie.posterUrl" 
                class="form-control"
                placeholder="https://example.com/poster.jpg"
              />
              @if (currentMovie.posterUrl) {
                <div class="preview-container">
                  <img [src]="currentMovie.posterUrl" alt="Poster Preview" class="poster-preview" />
                  <p class="preview-label">Poster Preview</p>
                </div>
              }
            </div>

            <div class="form-group">
              <label class="form-label">Trailer URL (YouTube Embed)</label>
              <input 
                type="url" 
                [(ngModel)]="currentMovie.trailerUrl" 
                class="form-control"
                placeholder="https://www.youtube.com/embed/VIDEO_ID"
              />
              <small class="form-hint">
                üí° Use YouTube embed format: https://www.youtube.com/embed/VIDEO_ID
              </small>
              @if (currentMovie.trailerUrl) {
                <div class="trailer-preview">
                  <iframe 
                    [src]="getSafeUrl(currentMovie.trailerUrl)" 
                    frameborder="0" 
                    allowfullscreen
                    class="trailer-iframe"
                  ></iframe>
                  <p class="preview-label">Trailer Preview</p>
                </div>
              }
            </div>

            <div class="form-group">
              <label class="form-label">IMDB URL</label>
              <input 
                type="url" 
                [(ngModel)]="currentMovie.imdbUrl" 
                class="form-control"
                placeholder="https://www.imdb.com/title/..."
              />
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn btn-outline" (click)="closeModal()">Cancel</button>
          <button class="btn btn-primary btn-large" (click)="saveMovie()">
            <span>{{ editMode ? 'üíæ Update Movie' : '‚ûï Create Movie' }}</span>
          </button>
        </div>
      </div>
    </div>
  }
</div>
